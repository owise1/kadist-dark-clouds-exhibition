var _pl={db:"liblib",design:"liblib-exhib"};window.URL=window.URL||window.webkitURL;var LibLibExhibApp=angular.module("LibLibExhibApp",["CornerCouch","ngSanitize"]).config(["$compileProvider",function(e){var i=/^\s*(https?|blob):/;e.aHrefSanitizationWhitelist(i),e.imgSrcSanitizationWhitelist(i)}]);LibLibExhibApp.controller("ListingCtrl",["$scope","$http","cornercouch",function(e,i,n){function t(){e.db.newDoc().load(s).success(function(i){e.exhibitionDoc=c(i)}).error(function(){e.db.newDoc({_id:s}).save().success(t).error(function(e){console.log("error 2"),console.log(e)})})}function o(){e.db.query(r.design,"media",{reduce:!1,limit:10,include_docs:!0}).success(function(i){e.medias=i.rows.map(R.prop("doc")).map(c).sort(function(e,i){return parseInt(e.info.order,10)>parseInt(i.info.order,10)}),t()})}function c(e){return e._attachments&&angular.forEach(e._attachments,function(i,n){/^cover\./.test(n)?e.coverImg="/"+r.db+"/"+e._id+"/"+n:(e.media=i,e.media.url="/"+r.db+"/"+e._id+"/"+n)}),e}var r=window._pl;e.db=n().getDB(r.db),e.touch=Modernizr.touch,e.currentVid=!1,e.setCurrent=function(i){e.currentVid=i};var s="liblib-exhib-exhibition";e.upload=function(i){for(var n,t=[],c=0;n=i.files[c];c++)t.push(n);t.forEach(function(i){var n=e.db.newDoc({name:i.name,content_type:i.type});n.save().success(function(){n.attach(i,i.name,o)})})},e.del=function(i){e.db.newDoc(i).remove().success(o)},e.save=function(i){var n=i.file;if(n){delete i.file;var t=e.db.newDoc(i);t.save().success(function(){t.attach(n,"cover."+n.name.split(".").pop(),o)})}else e.db.newDoc(i).save().success(o)},o()}]).directive("fileread",[function(){return{scope:{fileread:"="},link:function(e,i){i.bind("change",function(i){e.$apply(function(){e.fileread=i.target.files[0]})})}}}]).filter("sanitize",["$sce",function(e){return function(i){return e.trustAsHtml(i)}}]);
function resizeToCover(){jQuery("#video-viewport").width(jQuery(window).width()),jQuery("#video-viewport").height(jQuery(window).height());var e=jQuery(window).width()/vid_w_orig,i=jQuery(window).height()/vid_h_orig,d=e>i?e:i;min_w>d*vid_w_orig&&(d=min_w/vid_w_orig),jQuery("#video-viewport video").width(d*vid_w_orig),jQuery("#video-viewport video").height(d*vid_h_orig),jQuery("#video-viewport").scrollLeft((jQuery("#video-viewport video").width()-jQuery(window).width())/2),jQuery("#video-viewport").scrollTop((jQuery("#video-viewport video").height()-jQuery(window).height())/2),jQuery("#debug").html("<p>win_w: "+jQuery(window).width()+"</p>"),jQuery("#debug").append("<p>win_h: "+jQuery(window).height()+"</p>"),jQuery("#debug").append("<p>viewport_w: "+jQuery("#video-viewport").width()+"</p>"),jQuery("#debug").append("<p>viewport_h: "+jQuery("#video-viewport").height()+"</p>"),jQuery("#debug").append("<p>video_w: "+jQuery("video").width()+"</p>"),jQuery("#debug").append("<p>video_h: "+jQuery("video").height()+"</p>"),jQuery("#debug").append("<p>vid_w_orig: "+vid_w_orig+"</p>"),jQuery("#debug").append("<p>vid_h_orig: "+vid_h_orig+"</p>"),jQuery("#debug").append("<p>scale: "+d+"</p>")}var min_w=300,vid_w_orig,vid_h_orig;jQuery(function(){vid_w_orig=parseInt(jQuery("video").attr("width")),vid_h_orig=parseInt(jQuery("video").attr("height"))});